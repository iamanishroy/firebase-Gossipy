<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css" rel="stylesheet">
</head>

<body>
    <input id="fileInput" type="file" onchange="AlertFilesize();" accept="image/*" />
    <section id="sendImageDisplay" style="display: none;">
        <section class="text-gray-700 body-font overflow-hidden">
            <div class="container px-5 py-24 mx-auto">
                <div class="lg:w-4/5 mx-auto flex flex-wrap">
                    <img alt="ecommerce" id="sendImageDisplayimg"
                        class="lg:w-1/2 w-full lg:h-auto h-auto object-cover object-center rounded">
                    <div class="lg:w-1/2 w-full lg:pr-10 lg:py-6 mb-6 lg:mb-0">
                        <h2 class="text-sm title-font text-gray-500 tracking-widest">Send to: <span
                                style="color: #f56565;">Anish</span></h2>
                        <div class="flex border-t border-gray-300 py-2">
                            <span class="text-gray-500">Size</span>
                            <span id="sendImageDisplaySize" class="ml-auto text-gray-900">125.85 KB</span>
                        </div>
                        <div id="warning" class="flex mb-8">
                            <!--  -->
                        </div>
                        <div class="flex">
                            <button id="imgSendBtn" onclick="sendImg()"
                                class="flex ml-auto mr-auto text-white bg-red-500 border-0 py-2 px-12 focus:outline-none hover:bg-red-600 rounded">Send</button>
                        </div>
                    </div>
                </div>
            </div>
            <label>Downloading progress:</label>
            <progress id="prog" value="0" max="100"> 32% </progress>
        </section>
    </section>
</body>
<script src="assets/plugins/bower_components/jquery/dist/jquery.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.19.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.19.1/firebase-storage.js"></script>
<script src="assets/main/fbconfig.js"></script>
<script src="assets/plugins/bower_components/sweetalert/sweetalert.min.js"></script>
<script type="text/javascript">
    function AlertFilesize() {
        $('#fileInput').hide();
        $('#sendImageDisplay').show();
        var sizeinbytes = document.getElementById('fileInput').files[0].size;
        $("#sendImageDisplayimg").fadeIn("fast").attr('src', URL.createObjectURL(document.getElementById('fileInput').files[0]));
        if (sizeinbytes / 1024 > 3072) {
            $('#warning').html(`<a class="flex-grow text-red-500 border-b-2 border-red-500 py-2 text-lg px-1">Image size should be less than 3 MB</a>`);
            $('#imgSendBtn').attr('disabled');
            $('#imgSendBtn').attr('style', 'background-color: gray;');

        }
        var fSExt = new Array('Bytes', 'KB', 'MB', 'GB');
        fSize = sizeinbytes;
        i = 0;
        while (fSize > 900) {
            fSize /= 1024;
            i++;
        }
        $('#sendInamgDisplaySize').text((Math.round(fSize * 100) / 100) + ' ' + fSExt[i]);
    }
    function sendImg() {
        const ref = firebase.storage().ref();
        // $('#savePost').text('posting...')
        const file = document.querySelector("#fileInput").files[0];
        const name = +new Date() + "-" + file.name;
        const metadata = { contentType: file.type };
        const task = ref.child(name).put(file, metadata);

        task.then(snapshot => snapshot.ref.getDownloadURL())
            .then(url => {
                console.log("Uploaded");
                console.log("URL => " + url);

                // var user = firebase.auth().currentUser;
                // var pid = new Date().getTime();
                // var mature = false;
                // if ($("#mature-check").prop("checked") == true) {
                //     mature = true;
                // }
                // firebase.database().ref('posts/' + pid).set({
                //     owner: user.uid,
                //     postId: pid,
                //     link: url,
                //     tags: finalTag.trim(),
                //     desc: $('#postDesc').val().trim(),
                //     mature: mature
                // }).then(t => {
                //     location.reload();
                // });
            }).catch(console.error);
        var sen = true;
        task.on('state_changed',
            function progress(snapshot) {
                if (sen) {
                    $('#imgSendBtn').text('Sending...')
                    sen = false;
                } else {
                    $('#imgSendBtn').text('Sent')
                }
            });
    }
</script>

</html>